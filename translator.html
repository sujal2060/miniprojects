<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUJAL - Preeti to Unicode Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Preeti';
            src: local('Preeti'), url('Preeti.ttf?v=1.2') format('truetype');
            font-display: swap;
            font-weight: normal;
            font-style: normal;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html,
        body {
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
            animation: particleFloat 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes particleFloat {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0 0 30px 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: white;
            padding: 20px 30px;
            flex-shrink: 0;
            z-index: 20;
            text-align: center;
            margin: 0 20px;
            margin-top: 20px;
        }

        .header-line-1 {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .header-line-2 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 80px;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        .brand-logo:hover {
            transform: scale(1.05) rotate(-2deg);
        }

        .brand-wrapper {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }

        .converter-subtitle {
            font-size: 14px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            letter-spacing: 3px;
            text-transform: uppercase;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .brand-title {
            font-weight: 900;
            letter-spacing: -1px;
            font-size: 28px;
            white-space: nowrap;
            color: white;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .char-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 12px 20px;
            width: calc(100% - 40px);
            margin: 15px 20px 0;
            border-radius: 20px;
            flex-shrink: 0;
            z-index: 10;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .char-bar::-webkit-scrollbar {
            height: 6px;
        }

        .char-bar::-webkit-scrollbar-track {
            background: transparent;
        }

        .char-bar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .char-bar.active {
            display: none;
        }

        .char-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            height: 45px;
            width: 45px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .char-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .char-btn:active {
            transform: translateY(0);
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 20px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                overflow: auto;
                gap: 15px;
            }

            .pane {
                height: 350px;
                flex: none;
            }

            body {
                overflow: auto;
            }

            .header {
                margin: 10px;
                padding: 15px 20px;
                border-radius: 0 0 20px 20px;
            }

            .char-bar {
                margin: 10px;
                width: calc(100% - 20px);
            }

            .container {
                padding: 10px;
            }
        }

        .pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .pane:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .label {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 0 25px;
            height: 50px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 25px 25px 0 0;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        textarea {
            flex: 1;
            width: 100%;
            padding: 30px;
            font-size: 20px;
            border: none;
            outline: none;
            resize: none;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.9);
            color: #2d3748;
            border-radius: 0 0 25px 25px;
            font-family: 'Inter', sans-serif;
        }

        textarea::placeholder {
            color: rgba(45, 55, 72, 0.4);
        }

        #preetiBox {
            font-family: 'Preeti', 'Adobe Devanagari', serif !important;
            color: #1a202c !important;
            text-transform: none !important;
            -webkit-text-fill-color: #1a202c !important;
            line-height: normal !important;
        }

        #unicodeBox {
            color: #1a202c;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 12px;
            text-decoration: none;
            border: none;
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .btn-slate {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        .btn-red {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .size-ctrl {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 0 8px;
            color: white;
            gap: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .size-btn {
            background: transparent;
            color: white;
            width: 32px;
            height: 32px;
            border: none;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.2s ease;
            border-radius: 8px;
        }

        .size-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>

    <div class="header">
        <div class="header-line-1">
            <div class="brand-wrapper">
                <img src="assets/brandname.webp" alt="SUJAL" class="brand-logo" onclick="clearAll()"
                    onerror="this.style.display='none'">
                <div class="converter-subtitle">Converter</div>
            </div>
        </div>

        <div class="header-line-2">
            <a href="https://www.sujaldevkota.com.np" target="_blank" class="btn btn-green">sujaldevkota.com.np</a>
            <button class="btn btn-purple" onclick="toggleSpecialChars()">SYMBOLS</button>
            <div class="size-ctrl">
                <button class="size-btn" onclick="changeFontSize(-4)">अ−</button>
                <button class="btn btn-slate" style="background:transparent; box-shadow: none;"
                    onclick="resetFontSize()">RESET</button>
                <button class="size-btn" onclick="changeFontSize(4)">अ+</button>
            </div>
            <button class="btn btn-red" onclick="clearAll()">CLEAR</button>
        </div>
    </div>

    <div id="specialCharsBar" class="char-bar">
        <button class="char-btn" onclick="insertChar('फ्', true)">फ्</button>
        <button class="char-btn" onclick="insertChar('घ्', true)">घ्</button>
        <button class="char-btn" onclick="insertChar('र्‍', true)">र्‍</button>
        <button class="char-btn" onclick="insertChar('झ्', true)">झ्</button>
        <button class="char-btn" onclick="insertChar('ऋ')">ऋ</button>
        <button class="char-btn" onclick="insertChar('ॐ', true)">ॐ</button>
        <button class="char-btn" onclick="insertChar('रू', true)">रू</button>
        <button class="char-btn" onclick="insertChar('＝')">=</button>
        <button class="char-btn" onclick="insertChar('ड्ड', true)">ड्ड</button>
        <button class="char-btn" onclick="insertChar('ड्ढ', true)">ड्ढ</button>
        <button class="char-btn" onclick="insertChar('＠')">@</button>
        <button class="char-btn" onclick="insertChar('＃')">#</button>
        <button class="char-btn" onclick="insertChar('＄')">$</button>
        <button class="char-btn" onclick="insertChar('％')">%</button>
        <button class="char-btn" onclick="insertChar('＊')">*</button>
        <button class="char-btn" onclick="insertChar('｜')">|</button>
    </div>

    <div class="container">
        <div class="pane pane-left">
            <div class="label">1. Preeti Input</div>
            <textarea id="preetiBox" spellcheck="false" autofocus placeholder="Type Preeti here..."></textarea>
        </div>
        <div class="pane">
            <div class="label">2. Unicode Result <button class="btn btn-purple"
                    style="padding: 6px 10px; font-size: 11px;" onclick="copyUnicode()">COPY</button></div>
            <textarea id="unicodeBox" spellcheck="false" placeholder="Type or Edit Unicode here..."></textarea>
        </div>
    </div>
    <script>
        var all_rules = {
            "preeti": {
                "post-rules": [
                    // 1. Ikar Reordering (Must be first)
                    ["\uF001((?:[\u0915-\u0939]\u094d)*[\u0915-\u0939])", "$1ि"],

                    // 2. IDENTITY NORMALIZATION
                    ["क्षा", "क्ष"],

                    // GENERIC FIX FOR HALF LETTERS
                    ["(.)्ा", "$1"],

                    // 3. Complex Clusters
                    ["(त्र|त्त)([^उभप]+?)m", "$1m$2"],
                    ["त्रm", "क्र"], ["त्तm", "क्त"],
                    ["([^उभप]+?)m", "m$1"],
                    ["उm", "ऊ"], ["भm", "झ"], ["पm", "फ"],

                    // 4. Fixes for Au/O/Aa
                    ["अा[ंँ]ै", "औं"], ["अा[ंँ]े", "ओं"],
                    ["अाै", "औ"], ["अाे", "ओ"], ["अा", "आ"],
                    ["एे", "ऐ"], ["ाे", "ो"], ["ाै", "ौ"],

                    // 5. Handle Ee+Reph
                    ["इ\\{", "ई"],
                    ["इ", "इ"],

                    // 6. MOVE REPH
                    ["(.[ािीुूृेैोौंःँ]*?)\\{", "{$1"],

                    // 7. Convert Reph marker to 'Ra'
                    ["\\{", "र्"],

                    // 8. SPECIFIC WORD CLEANUPS
                    ["(.[ि])ा", "$1"],
                    ["निष्कर्षा", "निष्कर्ष"],

                    // 9. Final Cleanup
                    ["्ा", ""],
                    ["्([ािीुूृेैोौँंः])", "$1्"],
                    ["(.[ंँ])(.[ािीुूृेैोौ])", "$1$2"],
                    ["ँँ", "ँ"], ["ंं", "ं"], ["ेे", "े"], ["ैै", "ै"],
                    ["^ः", ":"], ["टृ", "ट्ट"],
                    ["\uF001", "ि"]
                ],
                "char-map": {
                    // Standard Preeti Map
                    "(": "९", ")": "०",

                    "0": "ण्",
                    "÷": "/", "v": "ख", "r": "च", "\"": "ू", "~": "ञ्", "z": "श", "ç": "ॐ", "f": "ा", "b": "द", "n": "ल", "j": "व", "V": "ख्", "R": "च्", "Z": "श्", "F": "ँ", "B": "द्य", "N": "ल्", "Ë": "ङ्ग", "J": "व्", "6": "ट", "2": "द्द", "¿": "रू", ">": "श्र", ":": "स्", "§": "ट्ट", "&": "७", "£": "घ्", "•": "ड्ड", ".": "।", "«": "्र", "*": "८", "w": "ध", "s": "क", "g": "न", "c": "अ", "o": "य", "k": "प", "W": "ध्", "Ö": "=", "S": "क्", "_": ")", "[": "ृ", "G": "न्", "ˆ": "फ्", "C": "ऋ", "O": "इ", "Î": "ङ्क", "K": "प्", "7": "ठ", "¶": "ठ्ठ", "3": "घ", "9": "ढ", "?": "रु", ";": "स", "'": "ु", "#": "३", "/": "र", "+": "ं", "ª": "ङ", "t": "त", "p": "उ", "|": "्र", "x": "ह", "å": "द्व", "d": "म", "`": "ञ", "l": "\uF001", "h": "ज", "T": "त्", "P": "ए", "\\": "्", "X": "ह्", "Å": "हृ", "D": "म्", "@": "२", "Í": "ङ्क", "L": "ी", "H": "ज्", "4": "द्ध", "<": "?", "8": "ड", "¥": "र्‍", "$": "४", "¡": "ज्ञ्", ",": ",", "u": "ग", "q": "त्र", "}": "ै", "y": "थ", "e": "भ", "a": "ब", "i": "ष्", "U": "ग्", "Q": "त्त", "]": "े", "Y": "थ्", "E": "भ्", "A": "ब्", "M": "ः", "I": "क्ष", "5": "छ", "´": "झ", "1": "ज्ञ", "°": "ङ्ढ", "=": ".", "%": "५", "¤": "झ्", "!": "१", "-": "(", "^": "६", "›": "द्र"
                }
            }
        };

        const preBox = document.getElementById('preetiBox');
        const uniBox = document.getElementById('unicodeBox');

        preBox.addEventListener('input', () => { uniBox.value = convert(preBox.value); });

        // --- NEW: PASTE HANDLER ---
        // This intercepts pasted text. If it contains ( or ), it replaces them 
        // with - or _ respectively so they *look* like brackets in the Preeti Input Box.
        preBox.addEventListener('paste', function (e) {
            e.preventDefault();
            var pastedData = (e.clipboardData || window.clipboardData).getData('text');

            // Swap standard brackets for Preeti visual equivalents
            // ( -> - (hyphen looks like '(' in Preeti)
            // ) -> _ (underscore looks like ')' in Preeti)
            var fixedData = pastedData.replace(/\(/g, '-').replace(/\)/g, '_');

            const start = preBox.selectionStart;
            const end = preBox.selectionEnd;
            const text = preBox.value;
            preBox.value = text.substring(0, start) + fixedData + text.substring(end);

            preBox.selectionStart = preBox.selectionEnd = start + fixedData.length;
            preBox.dispatchEvent(new Event('input'));
        });
        // --------------------------

        function convert(text) {
            if (!text) return "";
            const myFont = all_rules['preeti'];
            let output = '';

            const fullWidthMap = {
                '＠': '@', '＃': '#', '＄': '$', '％': '%', '＊': '*', '｜': '|', '＝': '='
            };

            for (let w = 0; w < text.length; w++) {
                const char = text[w];

                if (fullWidthMap[char]) {
                    output += fullWidthMap[char];
                    continue;
                }

                if (text.charCodeAt(w) === 8204) {
                    if (w + 1 < text.length) {
                        output += text[w + 1];
                        w++;
                    }
                    continue;
                }

                output += myFont['char-map'][char] || char;
            }

            myFont['post-rules'].forEach(rule => {
                output = output.replace(new RegExp(rule[0], 'g'), rule[1]);
            });
            return output;
        }

        let fontSize = 20;
        function changeFontSize(v) {
            fontSize = Math.max(12, Math.min(80, fontSize + v));
            preBox.style.fontSize = uniBox.style.fontSize = fontSize + 'px';
        }
        function resetFontSize() { fontSize = 20; preBox.style.fontSize = uniBox.style.fontSize = '20px'; }
        function clearAll() { preBox.value = uniBox.value = ""; preBox.focus(); }
        function copyUnicode() { uniBox.select(); document.execCommand('copy'); }
        function toggleSpecialChars() { document.getElementById('specialCharsBar').classList.toggle('active'); }

        function insertChar(char, literal = false) {
            const start = preBox.selectionStart;
            const textToInsert = literal ? '\u200C' + char : char;
            preBox.value = preBox.value.substring(0, start) + textToInsert + preBox.value.substring(preBox.selectionEnd);
            preBox.selectionStart = preBox.selectionEnd = start + textToInsert.length;
            preBox.focus();
            preBox.dispatchEvent(new Event('input'));
        }
    </script>
</body>

</html>